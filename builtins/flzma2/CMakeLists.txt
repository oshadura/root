# Copyright (C) 1995-2021, Rene Brun and Fons Rademakers.
# All rights reserved.
#
# For the licensing terms see $ROOTSYS/LICENSE.
# For the list of contributors see $ROOTSYS/README/CREDITS.

project(FLMA2 C)

file(GLOB FLMA2_HEADERS *.h)
file(GLOB FLMA2_SOURCES *.c)

unset(FLMA2_FOUND CACHE)
unset(FLMA2_FOUND PARENT_SCOPE)
set(FLMA2_FOUND TRUE CACHE BOOL "" FORCE)

file(STRINGS "fast-lzma2.h" FLMA2_H REGEX "^#define FL2_VERSION_[A-Z]+[ ]+[0-9]+.*$")
string(REGEX REPLACE ".+FLMA2_VERSION_MAJOR[ ]+([0-9]+).*$"   "\\1" FL2_VERSION_MAJOR "${FLMA2_H}")
string(REGEX REPLACE ".+FLMA2_VERSION_MINOR[ ]+([0-9]+).*$"   "\\1" FL2_VERSION_MINOR "${FLMA2_H}")
string(REGEX REPLACE ".+FLMA2_VERSION_RELEASE[ ]+([0-9]+).*$" "\\1" FL2_VERSION_PATCH "${FLMA2_H}")
set(FLMA2_VERSION_STRING "${FLMA2_VERSION_MAJOR}.${FLMA2_VERSION_MINOR}.${FLMA2_VERSION_PATCH}")
unset(FLMA2_H)

set(FLMA2_VERSION ${FLMA2_VERSION_STRING} CACHE INTERNAL "" FORCE)
set(FLMA2_VERSION_STRING ${FLMA2_VERSION_STRING} CACHE INTERNAL "" FORCE)

set(FLMA2_INCLUDE_DIR ${CMAKE_CURRENT_SOURCE_DIR} CACHE INTERNAL "" FORCE)
set(FLMA2_INCLUDE_DIRS ${CMAKE_CURRENT_SOURCE_DIR} CACHE INTERNAL "" FORCE)

add_library(fast-lzma2 STATIC ${FLMA2_HEADERS} ${FLMA2_SOURCES})
if(NOT MSVC)
  target_compile_options(fast-lzma2 PRIVATE -fPIC)
endif()
target_link_libraries(fast-lzma2 PRIVATE xxHash::xxHash)

add_library(FLMA2::FLMA2 ALIAS fast-lzma2)

set(FLMA2_LIBRARY $<TARGET_FILE:FLMA2> CACHE INTERNAL "")
set(FLMA2_LIBRARIES FLMA2::FLMA2 CACHE INTERNAL "")
set_property(GLOBAL APPEND PROPERTY ROOT_BUILTIN_TARGETS FLMA2::FLMA2)

ROOT_INSTALL_HEADERS()
